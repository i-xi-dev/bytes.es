<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>test</title>
    <script type="module">
import test from "../test.mjs";
import { Resource } from "../../../dist/index.js";

test.it("fromDataUrl(string)", async () => {

  const b0 = Resource.fromDataUrl("data:text/plain,");
  test.assert.strictEqual(b0.size, 0);
  test.assert.strictEqual(b0.mediaType.toString(), "text/plain");

  const b0b = Resource.fromDataUrl("data:text/plain;base64,");
  test.assert.strictEqual(b0b.size, 0);
  test.assert.strictEqual(b0b.mediaType.toString(), "text/plain");

  const b0c = Resource.fromDataUrl("data: ,");
  test.assert.strictEqual(b0c.size, 0);
  test.assert.strictEqual(b0c.mediaType.toString(), "text/plain;charset=US-ASCII");

  const b0d = Resource.fromDataUrl("data: ; ,");
  test.assert.strictEqual(b0d.size, 0);
  test.assert.strictEqual(b0d.mediaType.toString(), "text/plain");

  const b0e = Resource.fromDataUrl("data: ; x=y ,");
  test.assert.strictEqual(b0e.size, 0);
  test.assert.strictEqual(b0e.mediaType.toString(), "text/plain;x=y");

  const b11 = Resource.fromDataUrl("data:text/plain,a1");
  const b11v = b11.bytes.view();
  test.assert.strictEqual(b11v[0], 97);
  test.assert.strictEqual(b11v[1], 49);
  test.assert.strictEqual(b11.size, 2);
  test.assert.strictEqual(b11.mediaType.toString(), "text/plain");

  const b12 = Resource.fromDataUrl("data:application/octet-stream;base64,AwIBAP/+/fw=");
  const b12v = b12.bytes.view();
  test.assert.strictEqual(b12v[0], 3);
  test.assert.strictEqual(b12v[1], 2);
  test.assert.strictEqual(b12v[2], 1);
  test.assert.strictEqual(b12v[3], 0);
  test.assert.strictEqual(b12v[4], 255);
  test.assert.strictEqual(b12v[5], 254);
  test.assert.strictEqual(b12v[6], 253);
  test.assert.strictEqual(b12v[7], 252);
  test.assert.strictEqual(b12.size, 8);
  test.assert.strictEqual(b12.mediaType.toString(), "application/octet-stream");

  const b21 = Resource.fromDataUrl("data:text/plain; p1=a,a1");
  const b21v = b21.bytes.view();
  test.assert.strictEqual(b21v[0], 97);
  test.assert.strictEqual(b21v[1], 49);
  test.assert.strictEqual(b21.size, 2);
  test.assert.strictEqual(b21.mediaType.toString(), "text/plain;p1=a");

  const b22 = Resource.fromDataUrl("data:text/plain; p1=a;p2=\"b,c\",a1");
  const b22v = b22.bytes.view();
  test.assert.strictEqual(b22v[0], 99);
  test.assert.strictEqual(b22v[1], 34);
  test.assert.strictEqual(b22v[2], 44);
  test.assert.strictEqual(b22v[3], 97);
  test.assert.strictEqual(b22v[4], 49);
  test.assert.strictEqual(b22.size, 5);
  test.assert.strictEqual(b22.mediaType.toString(), "text/plain;p1=a;p2=b");

  const b31 = Resource.fromDataUrl("data:text/plain,%FF%");
  const b31v = b31.bytes.view();
  test.assert.strictEqual(b31v[0], 255);
  test.assert.strictEqual(b31v[1], 0x25);
  test.assert.strictEqual(b31.size, 2);
  test.assert.strictEqual(b31.mediaType.toString(), "text/plain");

  const b32 = Resource.fromDataUrl("data:text/plain,%fff");
  const b32v = b32.bytes.view();
  test.assert.strictEqual(b32v[0], 255);
  test.assert.strictEqual(b32v[1], 0x66);
  test.assert.strictEqual(b32.size, 2);
  test.assert.strictEqual(b32.mediaType.toString(), "text/plain");

  const b33 = Resource.fromDataUrl("data:text/plain,a?a=2");
  const b33v = b33.bytes.view();
  test.assert.strictEqual(b33v[0], 0x61);
  test.assert.strictEqual(b33v[1], 0x3F);
  test.assert.strictEqual(b33v[2], 0x61);
  test.assert.strictEqual(b33v[3], 0x3D);
  test.assert.strictEqual(b33v[4], 0x32);
  test.assert.strictEqual(b33.size, 5);
  test.assert.strictEqual(b33.mediaType.toString(), "text/plain");

});

test.exec();
    </script>
  </head>
  <body>
  </body>
</html>
