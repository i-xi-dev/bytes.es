<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>test</title>
    <script type="module">
import test from "../../test.mjs";
import { TextEncoding } from "../../../../dist/index.js";
const Utf8 = TextEncoding.for("UTF-8");

test.it("decode(Uint8Array)", () => {
  test.assert.strictEqual(Utf8.decode(Uint8Array.of()), "");
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(49,227,129,130,51,194,169,10,240,160,128,139,97,98,99,10,97)), "1あ3\u{A9}\n\u{2000B}abc\na");
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(239,187,191,49,51)), "\uFEFF\u0031\u0033");
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(49,227,129,130,51,194,169)), "1あ3\u{A9}");

  test.assert.throws(() => {
    Utf8.decode(Uint8Array.of(0x31, 0x82, 0xA0, 0x33));
  }, {
    message: "decode error",
  });

  test.assert.strictEqual(Utf8.decode(Uint8Array.of(0xEF,0xBB,0xBF,49,227,129,130,51,194,169)), "\uFEFF1あ3\u{A9}");

});

test.it("decode(Uint8Array, Object)", () => {
  // fallback
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(), {fallback:"exception"}), "");
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(49,227,129,130,51,194,169,10,240,160,128,139,97,98,99,10,97), {fallback:"exception"}), "1あ3\u{A9}\n\u{2000B}abc\na");
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(239,187,191,49,51), {fallback:"exception"}), "\uFEFF\u0031\u0033");
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(49,227,129,130,51,194,169), {fallback:"exception"}), "1あ3\u{A9}");

  test.assert.throws(() => {
    Utf8.decode(Uint8Array.of(0x31, 0x82, 0xA0, 0x33), {fallback:"exception"});
  }, {
    message: "decode error",
  });
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(0x31, 0x82, 0xA0, 0x33), {fallback:"replacement"}), "1\u{FFFD}\u{FFFD}3");

  // removeBom
  test.assert.strictEqual(Utf8.decode(Uint8Array.of(0xEF,0xBB,0xBF,49,227,129,130,51,194,169), {removeBom:true}), "1あ3\u{A9}");

});

test.exec();
    </script>
  </head>
  <body>
  </body>
</html>
